---
title: "CAP प्रमेय का गहन विश्लेषण: उच्च समवर्ती और उच्च उपलब्धता वाली वितरित प्रणालियों का निर्माण"
date: 2024-12-27
draft: false
description: "वितरित प्रणालियों में CAP प्रमेय के अनुप्रयोग पर सिद्धांत से अभ्यास तक चर्चा।"
summary: "वितरित प्रणालियों में CAP प्रमेय के अनुप्रयोग पर सिद्धांत से अभ्यास तक चर्चा।"
tags: [ "वितरित प्रणाली", "CAP प्रमेय", "सिस्टम डिज़ाइन", "संगति मॉडल" ]
categories: [ "सिस्टम डिज़ाइन" , "वितरित प्रणाली" ]
---

## एक, CAP प्रमेय

### 1.1 CAP प्रमेय क्या है

**CAP प्रमेय** एरिक ब्रेवर द्वारा 2000 में प्रस्तावित की गई थी, जिसका मूल विचार है:

- **C (संगति)**: सिस्टम में सभी नोड्स एक ही समय में समान डेटा देखते हैं। अधिक सख्ती से कहें तो, जब कोई क्लाइंट डेटा पढ़ता है, तो परिणाम नवीनतम सबमिट किए गए डेटा के अनुरूप होना चाहिए, चाहे वह किसी भी प्रतिलिपि से पढ़ा जाए (आमतौर पर मजबूत संगति/रेखीय संगति को संदर्भित करता है)।
- **A (उपलब्धता)**: सिस्टम आंशिक विफलताओं के मामले में भी सामान्य सेवाएं प्रदान कर सकता है, और प्रत्येक अनुरोध को उचित समय के भीतर "मान्य प्रतिक्रिया" मिल सकती है (यह आवश्यक नहीं है कि सभी सफल हों, इसमें सही विफलता प्रतिक्रियाएं भी शामिल हैं)।
- **P (विभाजन सहिष्णुता)**: सिस्टम नेटवर्क विभाजन (नोड्स के बीच संचार दुर्गम हो जाता है) को सहन कर सकता है, और यहां तक कि अगर नेटवर्क विभाजित हो जाता है, तो सिस्टम कुछ हद तक उपलब्धता या संगति प्रदान कर सकता है।

वास्तविक वितरित वातावरण में, नेटवर्क विभाजन अपरिहार्य है, इसलिए **P** को मूल रूप से "अनिवार्य विकल्प" माना जाता है। जब नेटवर्क विभाजन होता है, तो सिस्टम सभी नोड्स के डेटा की *मजबूत संगति* और *उच्च उपलब्धता* दोनों को एक साथ नहीं रख सकता है, और केवल C और A के बीच चयन कर सकता है, जिसके परिणामस्वरूप **CP** और **AP** दो मुख्य प्रकार उत्पन्न होते हैं।

### 1.2 CAP प्रमेय की सीमाएँ

यह ध्यान दिया जाना चाहिए कि CAP प्रमेय स्वयं एक अपेक्षाकृत उच्च-स्तरीय सिद्धांत है, जिसका उपयोग वैचारिक मार्गदर्शन के लिए किया जाता है, और इसे **"या तो C चुनें या A चुनें"** के रूप में आसानी से नहीं समझा जा सकता है। कुछ सामान्य गलतफहमियाँ हैं:

1. **C आवश्यक रूप से मजबूत संगति नहीं है**
   CAP प्रमेय में C अक्सर संगति के सबसे सख्त अर्थ (यानी, रैखिक संगति) को संदर्भित करता है। लेकिन वास्तविक प्रणालियों में, हमारे पास कमजोर संगति, पढ़ी गई प्रतिबद्धता (Read Committed), कारण संगति (Causal Consistency) और कई अन्य बारीक मॉडल हैं जिन्हें चुना जा सकता है।
2. **उपलब्धता 0 या 1 नहीं है**
   यह नहीं कहा जा सकता है कि CP चुनने का मतलब है कि उपलब्धता पूरी तरह से त्याग दी गई है; या AP चुनने का मतलब है कि संगति की कोई गारंटी नहीं है। उपलब्धता और संगति दोनों में विभिन्न स्तरों के ट्रेड-ऑफ और डिग्रेडेशन रणनीतियाँ हैं।
3. **अंतिम संगति** CAP का उल्लंघन नहीं करती है
   यह एक बहुत ही सामान्य समझौता समाधान है, जो उच्च उपलब्धता और थ्रूपुट के लिए कम लेखन संगति का उपयोग करता है, और पृष्ठभूमि में डेटा को अभिसरित करने के लिए अतुल्यकालिक तरीकों का उपयोग करता है।

इसलिए, CAP प्रमेय को विभिन्न **संगति मॉडल** और **उच्च उपलब्धता वास्तुकला पैटर्न** के साथ विशिष्ट परिदृश्यों में जोड़ा जाना चाहिए ताकि वास्तविक कार्यान्वयन मार्गदर्शन मूल्य उत्पन्न हो सके।

------

## दो, वितरित प्रणालियों का संगति मॉडल

संगति मॉडल का वर्गीकरण बहुत समृद्ध है, लेकिन सामान्य मुख्यधारा के मॉडल को मोटे तौर पर **मजबूत संगति** और **कमजोर संगति** (जिसमें अंतिम संगति, कारण संगति आदि शामिल हैं) में विभाजित किया जा सकता है। यह लेख मुख्य रूप से **मजबूत संगति** और **अंतिम संगति** का परिचय देता है, और CP या AP मोड के तहत उनके सामान्य अनुप्रयोगों का वर्णन करता है।

### 2.1 मजबूत संगति

**मजबूत संगति (Strong Consistency)**, जिसे **रेखीय संगति (Linearizability)** भी कहा जाता है, का अर्थ है कि एक बार जब कोई लेखन ऑपरेशन सफलतापूर्वक पूरा हो जाता है, तो कोई भी बाद का पठन ऑपरेशन उस अद्यतन सामग्री को पढ़ सकता है। दूसरे शब्दों में, सिस्टम सभी कार्यों को क्रमिक रूप से निष्पादित करने जैसा दिखता है।

- **सामान्य कार्यान्वयन**: सिंक्रोनस प्रतिकृति और एक मध्यस्थता (बहुमत) तंत्र पर निर्भर करता है, और यह सुनिश्चित करने के लिए प्रोटोकॉल (जैसे Paxos/Raft) का उपयोग करता है कि सिस्टम में केवल एक प्रभावी नेता (Leader) है, और सभी संचालन क्रम में लॉग में लिखे जाते हैं और अधिकांश नोड्स में दोहराए जाते हैं।
- फायदे और नुकसान:
    - फायदे: सबसे सख्त डेटा शुद्धता की गारंटी देता है, और किसी भी समय पढ़ा गया डेटा "रोलबैक" नहीं होता है।
    - नुकसान: नेटवर्क झटकों, विभाजन या नेता की विफलता के मामले में, संगति बनाए रखने के लिए अक्सर लेखन संचालन को अवरुद्ध किया जाएगा, जिससे समग्र उपलब्धता में गिरावट आएगी; प्रदर्शन और थ्रूपुट भी अपेक्षाकृत कम हैं।

### 2.2 अंतिम संगति

**अंतिम संगति (Eventual Consistency)** कमजोर संगति का एक विशिष्ट रूप है, जिसके लिए केवल यह आवश्यक है कि यदि सिस्टम में कोई नया अद्यतन ऑपरेशन नहीं है, तो समय के साथ, सभी प्रतियों का डेटा धीरे-धीरे एक ही स्थिति में अभिसरित हो जाएगा। इस दौरान, उपयोगकर्ता प्रतिलिपि डेटा पढ़ सकते हैं, और पुराने मान देख सकते हैं, लेकिन अंततः यह सुसंगत हो जाएगा।

- **सामान्य कार्यान्वयन**: गॉसिप प्रोटोकॉल, मल्टी-रेप्लिका एसिंक्रोनस रेप्लिकेशन, CRDT (Conflict-free Replicated Data Type), आदि।
- फायदे और नुकसान:
    - फायदे: उच्च उपलब्धता, उच्च थ्रूपुट, कम लेखन संचालन विलंबता, और नेटवर्क विभाजन के लिए उच्च सहिष्णुता।
    - नुकसान: थोड़े समय के लिए डेटा असंगति को सहन करने की आवश्यकता है, एप्लिकेशन तर्क अधिक जटिल है, और संघर्ष का पता लगाने और विलय करने की आवश्यकता हो सकती है।

------

## तीन, सामान्य संगति प्रोटोकॉल और एल्गोरिदम

वितरित सिस्टम प्रतियों के बीच संगति बनाए रखने के लिए, उद्योग ने कई क्लासिक एल्गोरिदम और प्रोटोकॉल प्रस्तावित किए हैं। यहां कुछ का संक्षिप्त परिचय दिया गया है:

### 3.1 Paxos

Paxos एक वितरित संगति एल्गोरिथम है जिसे लेस्ली लैम्पपोर्ट ने 1990 के दशक में प्रस्तावित किया था, जिसका उपयोग मुख्य रूप से मजबूत संगति या रैखिक संगति को प्राप्त करने के लिए किया जाता है।

- **मूल सिद्धांत**: भूमिका विभाजन (प्रस्तावक Proposer, स्वीकर्ता Acceptor, शिक्षार्थी Learner) के माध्यम से कई दौर के मतदान के माध्यम से, यह तय करने के लिए कि क्या किसी ऑपरेशन या मान को अधिकांश नोड्स द्वारा स्वीकार किया जाता है।
- फायदे और नुकसान:
    - फायदे: नेटवर्क विभाजन और नोड विफलताओं के तहत भी संगति प्राप्त कर सकता है, और इसमें उच्च सुरक्षा है।
    - नुकसान: कार्यान्वयन जटिल है, डिबगिंग और समस्या निवारण मुश्किल है, और कई दौर के मतदान के कारण प्रदर्शन सीमित है। उद्योग में इसके अधिक प्रकार (मल्टी-Paxos, आदि) का उपयोग किया जाता है।

### 3.2 Raft

Raft को आधिकारिक तौर पर 2013 में प्रस्तावित किया गया था, जिसका लक्ष्य **Paxos के समान सुरक्षा सुनिश्चित करते हुए कार्यान्वयन और समझने की कठिनाई को सरल बनाना** था। यह एक स्थिर *नेता (Leader)* भूमिका स्थापित करके, केंद्रीकृत रूप से लॉग प्रतिकृति और विफलता पुनर्प्राप्ति करता है:

- **महत्वपूर्ण चरण**: नेता चुनाव (Leader Election), लॉग प्रतिकृति (Log Replication), सुरक्षा (Safety), आदि।
- **सामान्य अनुप्रयोग**: Etcd, Consul, TiKV, LogCabin, आदि सभी मजबूत संगति प्रतिकृति को लागू करने के लिए Raft पर आधारित हैं।
- फायदे और नुकसान:
    - फायदे: अपेक्षाकृत समझने में आसान, कम कार्यान्वयन कोड; छोटे और मध्यम आकार के क्लस्टर के लिए बेहतर प्रदर्शन।
    - नुकसान: मुख्य नोड (नेता) पर निर्भर करता है, और मुख्य नोड की विफलता या विभाजन से थोड़े समय के लिए लेखन अवरुद्ध हो जाएगा; बड़े पैमाने पर क्लस्टर या क्रॉस-क्षेत्रीय परिनियोजन में, विलंबता और उपलब्धता प्रभावित होगी।

### 3.3 गॉसिप प्रोटोकॉल

गॉसिप (गपशप) प्रोटोकॉल पारंपरिक सहमति प्रोटोकॉल नहीं है, इसका उपयोग मुख्य रूप से विकेन्द्रीकृत परिदृश्यों में नोड्स के बीच यादृच्छिक बातचीत के माध्यम से मेटाडेटा या स्थिति जानकारी का आदान-प्रदान करने के लिए किया जाता है, ताकि पूरे नेटवर्क में प्रसार और अभिसरण हो सके।

- **विशेषताएं**: विकेन्द्रीकृत, कम ओवरहेड, और नोड्स के बीच आवधिक और यादृच्छिक संदेशों का आदान-प्रदान।
- **सामान्य अनुप्रयोग**: कैसेंड्रा, रियाक, वितरित सदस्य प्रबंधन (जैसे सर्फ), आदि, का उपयोग अंतिम संगति, प्रतिलिपि स्थिति सिंक्रनाइज़ेशन आदि को लागू करने के लिए किया जाता है।
- फायदे और नुकसान:
    - फायदे: अच्छी स्केलेबिलिटी, लागू करने में आसान, उन परिदृश्यों के लिए उपयुक्त है जिनमें संगति की आवश्यकताएं अधिक नहीं हैं और स्केलेबिलिटी की आवश्यकताएं अधिक हैं।
    - नुकसान: संगति की गारंटी कमजोर है, और संघर्षों को अंततः हल करने के लिए उच्च-स्तरीय संघर्ष समाधान विधियों (जैसे CRDT, संस्करण संख्या विलय, आदि) की आवश्यकता है।

### 3.4 2PC / 3PC

वितरित लेनदेन परिदृश्यों में, सामान्य प्रतिबद्धता प्रोटोकॉल **2PC (दो-चरण प्रतिबद्धता)** और **3PC (तीन-चरण प्रतिबद्धता)** हैं:

- **2PC**: समन्वयक सभी प्रतिभागियों को "तैयार (prepare)" करने के लिए सूचित करता है, और यदि सभी सफल होते हैं, तो "प्रतिबद्ध (commit)" प्रसारित करता है, अन्यथा "रोलबैक (abort)" करता है।
- **3PC**: 2PC के आधार पर एक चरण जोड़ा जाता है, जो एकल बिंदु विफलता के कारण होने वाले अवरोध को कम करता है, लेकिन कार्यान्वयन अधिक जटिल है, और अभी भी चरम नेटवर्क विभाजन या विफलता परिदृश्यों के तहत अनुपलब्धता की समस्या है।
- फायदे और नुकसान:
    - फायदे: समझने में आसान, लेनदेन शब्दार्थ स्पष्ट हैं, और वितरित डेटाबेस, संदेश कतारों आदि में व्यापक रूप से उपयोग किए जाते हैं।
    - नुकसान: समन्वयक पर मजबूत निर्भरता, अवरोध का जोखिम; जब नेटवर्क लंबे समय तक विभाजित होता है, तो लेनदेन को आगे बढ़ाना संभव नहीं हो सकता है।

------

## चार, CAP के दो मुख्यधारा के विकल्प: CP और AP

जब हम मानते हैं कि **P** एक "अनिवार्य" विशेषता है, तो यदि वितरित सिस्टम नेटवर्क विभाजन के दौरान सेवाएं प्रदान करना जारी रखना चाहता है, तो उसे **C** और **A** के बीच चयन करना होगा। इसलिए, सामान्य सिस्टम डिज़ाइन **CP** और **AP** के दो प्रमुख शिविरों में विभाजित हो गया है।

### 4.1 CP सिस्टम

**CP (संगति + विभाजन सहिष्णुता)**: जब नेटवर्क विभाजन का सामना करना पड़ता है, तो सिस्टम **संगति को प्राथमिकता देना** चुनता है, और आवश्यकता पड़ने पर **उपलब्धता का त्याग करता है**।

- विशिष्ट कार्यान्वयन:
    - बहुमत सहमति (Paxos, Raft, आदि), जिसके लिए आधे से अधिक नोड्स को जीवित रहने और एक समझौते पर पहुंचने की आवश्यकता होती है ताकि लेखन की अनुमति दी जा सके।
    - यदि वर्तमान में कोरम (कानूनी संख्या) तक नहीं पहुंचा जा सकता है या मुख्य नोड विफल हो जाता है, तो सिस्टम मस्तिष्क विभाजन के कारण डेटा असंगति को रोकने के लिए लेखन संचालन को अवरुद्ध या अस्वीकार कर देगा।
- सामान्य अनुप्रयोग:
    - ज़ूकीपर, एटसीडी, कंसुल, वितरित लॉक सेवाएं, वितरित मेटाडेटा प्रबंधन, आदि।
    - वित्तीय लेनदेन मुख्य प्रक्रियाएं, बैंक लेखा प्रणाली और अन्य उच्च संगति आवश्यकताओं वाले परिदृश्य।
- विशेषताएं:
    - सख्त डेटा गारंटी है: दोहरे मुख्य या डेटा भ्रम से बचने के लिए शटडाउन करना बेहतर है।
    - कुछ उपलब्धता का त्याग करें: नेटवर्क विभाजन या विफलता स्विचओवर के मामले में, एक सेवा अनुपलब्ध होगी या लेखन संचालन को अस्वीकार करने की अवधि होगी।

### 4.2 AP सिस्टम

**AP (उपलब्धता + विभाजन सहिष्णुता)**: जब नेटवर्क विभाजन का सामना करना पड़ता है, तो सिस्टम **उपलब्धता को प्राथमिकता देना** चुनता है, और साथ ही **संगति को कम करता है**।

- विशिष्ट कार्यान्वयन:
    - अंतिम संगति, मल्टी-मास्टर प्रतिकृति, गॉसिप प्रोटोकॉल, डायनेमो-शैली समायोज्य संगति नीतियां, आदि।
- सामान्य अनुप्रयोग:
    - NoSQL डेटाबेस (कैसेंड्रा, रियाक, डायनेमोडीबी, आदि), वितरित कैशिंग सिस्टम (रेडिस क्लस्टर), आदि।
    - सोशल नेटवर्क, लॉग संग्रह, अनुशंसा प्रणाली और अन्य व्यवसाय जिन्हें उच्च उपलब्धता और उच्च थ्रूपुट की आवश्यकता होती है, और डेटा संगति के लिए अपेक्षाकृत कम आवश्यकताएं होती हैं।
- विशेषताएं:
    - विभाजन होने पर भी, सभी नोड्स अभी भी पढ़ने और लिखने के अनुरोधों को स्वीकार करते हैं, यह सुनिश्चित करते हुए कि सिस्टम "जहां तक संभव हो उपलब्ध" है।
    - डेटा में थोड़े समय के लिए असंगति हो सकती है, लेकिन यह पृष्ठभूमि में अतुल्यकालिक सिंक्रनाइज़ेशन और संघर्ष विलय जैसे तरीकों से धीरे-धीरे अभिसरित हो जाएगा।

------

## पांच, CP और AP में कैसे चयन करें?

वास्तविक बड़े पैमाने पर वितरित प्रणालियों में, यह अक्सर **केवल एक मॉडल पर निर्भर नहीं होता है**, बल्कि विभिन्न डेटा या व्यावसायिक परिदृश्यों को स्तरित तरीके से संसाधित करता है, ताकि **संगति** और **उपलब्धता** का इष्टतम संतुलन प्राप्त किया जा सके।

1. **मुख्य डेटा CP चुनें**
    - जैसे उपयोगकर्ता खाता शेष, ऑर्डर भुगतान, वित्तीय लेनदेन प्रवाह, आदि, जिनकी संगति के लिए बहुत अधिक आवश्यकताएं हैं।
    - नेटवर्क झटकों के कारण होने वाले थोड़े समय के लिए गैर-लेखन को सहन करें, लेकिन शेष राशि या लेनदेन राशि में त्रुटियों को सहन न करें।
2. **परिधीय या कैश डेटा AP चुनें**
    - जैसे उत्पाद विवरण पृष्ठ का कैश, उपयोगकर्ता व्यवहार लॉग, अनुशंसा उम्मीदवार सूची, आदि, जिनकी संगति के लिए कम आवश्यकताएं हैं।
    - उच्च समवर्तीता और उच्च उपलब्धता पर अधिक ध्यान दें, और कुछ समय के लिए विलंबित अपडेट या गंदे पढ़ने को सहन करने में सक्षम हों।

कई इंटरनेट कंपनियां **मिश्रित वास्तुकला** को अपनाएंगी: मुख्य लेनदेन प्रक्रियाएं CP-शैली भंडारण (जैसे वितरित संबंधपरक डेटाबेस या मजबूत संगति के साथ वितरित भंडारण) का उपयोग करती हैं; परिधीय व्यवसाय या "अधिक पढ़ें और कम लिखें" परिदृश्य AP-शैली भंडारण या कैशिंग समाधान का उपयोग करते हैं।

------

## छह, CP और AP उच्च समवर्तीता और अंतिम संगति को कैसे प्राप्त करते हैं

### 6.1 CP सिस्टम उच्च समवर्तीता से कैसे निपटते हैं

हालांकि सहमति प्रोटोकॉल को एकल क्लस्टर नोड आकार और उच्च लेखन अनुरोध मात्रा के मामले में उच्च विलंबता और कम थ्रूपुट का सामना करना पड़ेगा, फिर भी समवर्तीता और स्केलेबिलिटी को निम्नलिखित तरीकों से बढ़ाया जा सकता है:

1. बैच पढ़ना और लिखना
    - कई लेखन संचालन को क्लाइंट या मध्य परत में पैकेज करें, और उन्हें एक बार में नेता नोड पर लिखें, जिससे नेटवर्क राउंड ट्रिप और प्रोटोकॉल राउंड कम हो जाएं।
2. डेटाबेस और टेबल का विभाजन और बहु-क्लस्टर
    - डेटा को तार्किक या हैश द्वारा कई क्लस्टर (शार्डिंग) में विभाजित करें, और प्रत्येक क्लस्टर के अंदर CP प्रोटोकॉल चलाएं; अनुरोधों को रूटिंग या प्रॉक्सी परत के माध्यम से विभिन्न शार्ड में फैलाएं।
    - समग्र समवर्ती क्षमता में सुधार करें, और विफलता के प्रभाव को एकल शार्ड तक सीमित करें।

> CP सिस्टम का एकल शार्ड क्लस्टर थ्रूपुट अक्सर AP सिस्टम की तुलना में 2 से 10 गुना कम होता है।

### 6.2 AP सिस्टम अंतिम संगति की गारंटी कैसे देते हैं

AP सिस्टम आमतौर पर उच्च लेखन थ्रूपुट और पढ़ने की उपलब्धता प्रदान करने में सक्षम होते हैं, लेकिन संगति में ढील देते हैं, इसलिए पृष्ठभूमि या व्यावसायिक तर्क परत में संगति अभिसरण की गारंटी को लागू करने की आवश्यकता होती है:

1. संस्करण संख्या (वेक्टर क्लॉक) या तार्किक टाइमस्टैम्प
    - प्रत्येक अद्यतन ऑपरेशन को एक संस्करण संख्या (या लैम्पपोर्ट क्लॉक / हाइब्रिड क्लॉक पर आधारित) असाइन करें, और संघर्ष परिदृश्यों में विलय करें या टाइमस्टैम्प-आधारित जीत रणनीति (अंतिम लेखन जीत) का उपयोग करें।
2. गॉसिप प्रोटोकॉल / एंटी-एंट्रॉपी तंत्र
    - नोड्स समय-समय पर नवीनतम डेटा या मेटाडेटा का आदान-प्रदान करते हैं, और यदि संघर्ष पाए जाते हैं तो उन्हें मर्ज करते हैं।
3. समायोज्य संगति नीतियां
    - डायनेमो मॉडल द्वारा दर्शाए गए, क्लाइंट `R`, `W` और अन्य मापदंडों (जैसे बहुमत लिखना, प्रतिलिपि पुष्टिकरण) को कॉन्फ़िगर कर सकते हैं, ताकि संगति और उपलब्धता के बीच लचीले ढंग से समायोजित किया जा सके।
4. कस्टम संघर्ष समाधान नीतियां
    - व्यावसायिक शब्दार्थ के साथ विलय करें, जैसे कि शॉपिंग कार्ट को "संघ" के साथ विलय करना, और काउंटर को CRDT (G-काउंटर, PN-काउंटर, आदि) के साथ डेटा की एकरसता की गारंटी देना।

------

## सात, CP का क्रॉस-शार्ड मजबूत संगति कार्यान्वयन

अध्याय सात में, यह उल्लेख किया गया था कि **डेटाबेस और टेबल (शार्डिंग) को विभाजित करके**, एकल CP क्लस्टर के दबाव को उच्च समवर्तीता का समर्थन करने के लिए कई उप-क्लस्टर में "विभाजित" किया जा सकता है। हालांकि, जब व्यवसाय को शार्ड में लेनदेन करने की आवश्यकता होती है (यानी, कई डेटाबेस या टेबल के अपडेट शामिल होते हैं), तो अभी भी **बहु-शार्ड संगति** की चुनौती का सामना करना पड़ता है। आमतौर पर निम्नलिखित विचार होते हैं:

1. **वितरित लेनदेन: 2PC / 3PC**
    - यदि एप्लिकेशन को कई शार्ड में परमाणु अपडेट करने की आवश्यकता है, तो आमतौर पर प्रत्येक शार्ड की प्रतिबद्धता या रोलबैक को समन्वयित करने के लिए वितरित लेनदेन प्रोटोकॉल (जैसे 2PC, 3PC) का उपयोग किया जाता है।
    - समस्याएँ और उपाय:
        - 2PC/3PC दोनों एक समन्वयक नोड पर निर्भर करते हैं, जो एक एकल बिंदु बाधा बन सकता है।
        - गंभीर नेटवर्क विभाजन या समन्वयक विफलता के चरम मामलों में, अवरोध हो सकता है।
        - सामान्य तौर पर, अवरोध प्रभाव और डेटा असंगति जोखिम को कम करने के लिए मास्टर-स्लेव स्विचिंग, हार्टबीट डिटेक्शन और टाइमआउट तंत्र, आइडमपोटेंट रीट्राय, MVCC आदि का उपयोग किया जाएगा।
2. **सेल-आधारित वास्तुकला**
    - व्यवसाय को कई स्वायत्त इकाइयों में विभाजित करें, और प्रत्येक इकाई में डेटा एक ही शार्ड सेट में है, यह सुनिश्चित करते हुए कि अधिकांश लेनदेन केवल एक इकाई में पूरे होते हैं, जिससे क्रॉस-शार्ड संचालन कम हो जाते हैं।
    - इकाई सीमाओं पर डेटा का आदान-प्रदान करने के लिए अतुल्यकालिक या अंतिम संगति तंत्र का उपयोग करें, समग्र उच्च उपलब्धता और संगति दोनों को ध्यान में रखते हुए।
3. **वैश्विक वितरित डेटाबेस + वैश्विक सहमति प्रोटोकॉल**
    - उदाहरण के लिए, Google स्पैनर प्रत्येक शार्ड पर Paxos के माध्यम से प्रतिलिपि की मजबूत संगति प्रतिकृति को लागू करता है, और फिर क्रॉस-शार्ड संगति सुनिश्चित करने के लिए वैश्विक टाइमस्टैम्प प्रदान करने के लिए TrueTime API का उपयोग करता है।
    - इस योजना में कार्यान्वयन की जटिलता बहुत अधिक है, लेकिन यह वैश्विक स्तर पर मजबूत संगति के करीब वितरित लेनदेन क्षमता प्रदान कर सकती है।

> **सारांश**: मजबूत संगति की सख्त आवश्यकता वाले क्रॉस-शार्ड लेनदेन के लिए, **2PC/3PC + समन्वयक** अभी भी एक सामान्य समाधान है, और समन्वयक की उच्च उपलब्धता को यथासंभव बढ़ाकर विफलता की संभावना को कम किया जाता है। लेकिन इंजीनियरिंग अभ्यास में, क्रॉस-शार्ड लेखन संचालन को कम करने या सिस्टम की जटिलता को कम करने के लिए यूनिटाइजेशन विचारों के माध्यम से अधिकांश लेनदेन को एकल शार्ड सीमा तक सीमित करने की आवश्यकता है।

------

## आठ, प्रसिद्ध केस स्टडी

आइए संक्षेप में कुछ वितरित प्रणालियों पर चर्चा करें जिनका उद्योग में अक्सर उल्लेख किया जाता है, और देखें कि वे CAP पर कैसे चयन और कार्यान्वयन करती हैं:

1. **Google स्पैनर**
    - एक विशिष्ट **CP** सिस्टम (यहां तक कि "CA" भ्रम भी पैदा कर सकता है जिसे बाहरी दुनिया अक्सर कहती है, लेकिन सार में, इसे अभी भी कुछ उपलब्धता का त्याग करने की आवश्यकता है)।
    - TrueTime द्वारा प्रदान किए गए बाहरी सटीक टाइमस्टैम्प + प्रत्येक शार्ड के अंदर Paxos प्रतिकृति का उपयोग करके, यह क्रॉस-डेटा सेंटर मजबूत संगति की गारंटी देता है।
    - वैश्विक वित्तीय लेनदेन या उच्च संगति आवश्यकताओं वाले परिदृश्यों के लिए उपयुक्त, लेकिन बुनियादी ढांचे की लागत बहुत अधिक है।
2. **बिगटेबल / एचबेस**
    - सतह पर **CP** की ओर अधिक झुकाव, रीजनसर्वर और मास्टर के बीच वितरित समन्वय के माध्यम से मेटाडेटा की संगति सुनिश्चित करना।
    - लेकिन वास्तविक पढ़ने और लिखने के पथ में, यह बहु-प्रतिलिपि अतुल्यकालिक प्रतिकृति के माध्यम से उच्च उपलब्धता के कुछ साधन भी प्रदान कर सकता है, और पढ़ने की संगति को एप्लिकेशन आवश्यकताओं के अनुसार समायोजित किया जा सकता है।
3. **AWS डायनेमोडीबी**
    - **AP** की ओर झुकाव, प्रारंभिक डिज़ाइन प्रेरणा डायनेमो पेपर से आई है, और `R`, `W` और अन्य मापदंडों के माध्यम से संगति स्तर को समायोजित किया जा सकता है।
    - डिफ़ॉल्ट मोड के तहत, यह बहुत उच्च उपलब्धता और अंतिम संगति प्रदान करता है, और "मजबूत संगति पढ़ना" भी चालू किया जा सकता है (लेकिन यह केवल एकल विभाजन की मजबूत संगति की गारंटी देता है, आवश्यक नहीं कि क्रॉस-विभाजन)।
4. **कैसेंड्रा**
    - यह भी **AP** की ओर झुकाव है, और अंतर्निहित गॉसिप प्रोटोकॉल का उपयोग नोड टोपोलॉजी स्थिति को बनाए रखने के लिए किया जाता है।
    - पढ़ने और लिखने की संगति को पढ़ने और लिखने की प्रतिलिपि संख्या `R` / `W` को कॉन्फ़िगर किया जा सकता है, ताकि अंतिम संगति से मजबूत संगति में एक सहज संक्रमण प्राप्त किया जा सके।

> **तुलना से देखा जा सकता है**: इंजीनियरिंग में कोई पूर्ण "AP या CP" नहीं है, बल्कि विभिन्न संगति रणनीतियों का मिश्रण है; अधिकांश सिस्टम विभिन्न अनुप्रयोग परिदृश्यों के अनुकूल होने के लिए कुछ हद तक समायोज्य संगति प्रदान करते हैं।

------

## नौ, निष्कर्ष

1. **CAP प्रमेय एक आकार-फिट-सभी नहीं है**
    - वास्तविक वितरित प्रणालियाँ यह नहीं कह सकती हैं कि "मैं C चुनता हूँ और A छोड़ देता हूँ" या "मैं A चुनता हूँ और C छोड़ देता हूँ"।
    - उद्योग में अधिक सामान्य बात यह है कि विभिन्न डेटा आयामों और विभिन्न प्रकार के संचालन के लिए, लचीले ढंग से **CP** या **AP** मोड का चयन करें, और यहां तक कि एक ही सिस्टम के भीतर, विभिन्न तालिकाओं/विभिन्न कार्यों के लिए विभिन्न दोष सहिष्णुता और संगति रणनीतियों को अपनाएं।
2. **AP बिल्कुल 100% उपलब्ध नहीं है**
    - उदाहरण के लिए, कैसेंड्रा, डायनेमोडीबी, आदि भी चरम नेटवर्क विभाजन या नोड के बड़े पैमाने पर विफल होने पर अनुरोधों को पूरा करने में विफल रहेंगे।
    - AP सिस्टम केवल डिज़ाइन में "जब तक प्रतिलिपि लिखने योग्य है, तब तक पहले लिखें" की ओर झुकाव रखते हैं, और अपेक्षाकृत उच्च उपलब्धता और थ्रूपुट के बदले में संगति की कुछ गारंटी का त्याग करते हैं।
3. **CP भी उच्च उपलब्धता प्राप्त करने की पूरी कोशिश कर सकता है**
    - Paxos/Raft सामान्य परिस्थितियों में 99.99% या उससे भी अधिक उपलब्धता प्रदान कर सकते हैं, लेकिन इसके लिए अधिक नेटवर्क, हार्डवेयर और इंजीनियरिंग लागतों का निवेश करने की आवश्यकता होती है, और चरम नेटवर्क विभाजन के मामले में, यह अभी भी लेखन को अवरुद्ध करेगा और संगति बनाए रखने के लिए उपलब्धता का त्याग करेगा।
4. **मिश्रित वास्तुकला मुख्यधारा है**
    - मुख्य लेनदेन परिदृश्य मजबूत संगति (CP) पर जोर देते हैं, और परिधीय सहायक परिदृश्य या कैशिंग चैनल कमजोर संगति (AP) को अपनाते हैं, और दोनों एक दूसरे के साथ सहयोग करते हैं।
    - व्यावसायिक सहिष्णुता, नेटवर्क वातावरण, लागत निवेश और टीम के तकनीकी भंडार के साथ मिलकर व्यापक रूप से चयन करना आवश्यक है।

CAP प्रमेय वितरित प्रणालियों के डिजाइन के लिए एक उच्च-स्तरीय सोच ढांचा प्रदान करता है, जो हमें नेटवर्क विभाजन की अपरिहार्य वास्तविकता का सामना करने पर तर्कसंगत निर्णय लेने में मदद करता है। वास्तविक प्रणालियों में, संगति और उपलब्धता को संतुलित करने के लिए अधिक समृद्ध **संगति मॉडल**, **सहमति प्रोटोकॉल**, **बहु-प्रतिलिपि प्रतिकृति तंत्र** और इंजीनियरिंग अभ्यास (विपत्ति रिकवरी, डिग्रेडेशन, आइडमपोटेंस, संघर्ष विलय, आदि) की आवश्यकता होती है।